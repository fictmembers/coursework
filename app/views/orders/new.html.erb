<%= render 'layouts/header' %>

<div class="pannel">
<div class="row">
  <div class="col s4 offset-s4">
        <div class="card">
          <div class="card-image">
            <%= image_tag("order.jpg")%>
            <span class="card-title grey-text text-lighten-2">Make order:</span>

          </div>
          <div class="card-content">
              <% items = Item.all %>
            <%= form_for(@order) do |f| %>
              <ul class="collapsible" data-collapsible="accordion">
                <li>
                  <div class="collapsible-header"><i class="material-icons">person_pin</i>Set restaurant option</div>
                  <div class="collapsible-body">
                    <div class="field">

                      <% if !session[:restaurant].nil? %>
                        <% @waiter = Waiter.where("restaurant_id = ?", session[:restaurant]) %>
                        <% @manager = Manager.where("restaurant_id = ?", session[:restaurant]) %>
                        <% @chef = Chef.where("restaurant_id = ?", session[:restaurant]) %>
                        <%= f.hidden_field :restaurant_id, :value => session[:restaurant] %>
                      <% else %>
                        <% @waiter = Waiter.all %>
                        <% @manager = Manager.all %>
                        <% @chef = Manager.all %>
                        <%= f.collection_select :restaurant_id, Restaurant.all, :id, :name, { prompt: "-Select restaurant-" }, class: "browser-default" %>
                      <% end %>

                      <%= f.collection_select :customer_id, Customer.all, :id, :lastname, { prompt: "-Select customer-" }, class: "browser-default" %>
                      <%= f.collection_select :waiter_id, @waiter, :id, :lastname, { prompt: "-Select waiter-" }, class: "browser-default" %>
                      <%= f.collection_select :manager_id, @manager, :id, :lastname, { prompt: "-Select manager-" }, class: "browser-default" %>
                      <%= f.collection_select :chef_id, @chef, :id, :lastname, { prompt: "-Select chef-" }, class: "browser-default" %>
                    </div>
                  </div>
                </li>
                <li>
                  <div class="collapsible-header active"><i class="material-icons">settings</i>Customize order</div>
                  <div class="collapsible-body">
                    <div class="row">
                      <div class="col s11 offset-s1">
                        <% if !session[:restaurant].nil? %>
                          <% restaurant = Restaurant.find(session[:restaurant]) %>
                          <h5>Menu of <b><%= restaurant.name %></b></h5>
                          <% @menu = Menu.where('restaurant_id = ?', session[:restaurant]) %>
                        <% else %>
                          <% @menu = Menu.all %>
                        <% end %>
                        <% @menu.each do |f| %>
                            <%= hidden_field_tag "order[item_ids][]", nil %>
                            <h5> <%= f.cuisine %></h5>
                            <% current_cuisine = Item.where(menu_id: f.id) %>
                            <p>
                              <% current_cuisine.each do |item| %>
                                <%= check_box_tag "order[item_ids][]", item.id, @order.item_ids.include?(item.id), id: dom_id(item) %>
                                <%= label_tag dom_id(item), item.description+' '+item.price.to_s+'â‚¬' %><br>
                              <% end %>
                            </p>
                        <% end %>
                      </div>
                    </div>
                  </div>
                </li>
          <div class="card-action">
            <button class="btn waves-effect waves-light blue-grey darken-4" type="submit" name="action">Save information</button>
          </div>
        </div>
      </div>
      </div>
    </div>
  <% end %>
